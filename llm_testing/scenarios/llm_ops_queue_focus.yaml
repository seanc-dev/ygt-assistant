name: llm_ops_queue_focus
mode: mock
steps:
  - action: reset_state
  - action: http
    method: POST
    url: /dev/queue/seed
    params:
      count: 5
    expect:
      status: 200
  - action: http
    method: GET
    url: /api/queue
    expect:
      status: 200
    extract:
      action_id: "items.0.action_id"
  - action: http
    method: POST
    url: /api/queue/<action_id>/assistant-suggest
    json:
      message: "Link this action to a task and update its state"
    expect:
      status: 200
      contains:
        - "operations"
  - action: http
    method: POST
    url: /api/queue/<action_id>/assistant-suggest
    json:
      message: "Actually, can you also create a task for this?"
    expect:
      status: 200
      contains:
        - "operations"
  - action: http
    method: POST
    url: /api/queue/<action_id>/assistant-approve
    json:
      operation:
        op: "update_action_state"
        params:
          action_id: "<action_id>"
          state: "converted_to_task"
    expect:
      status: 200
expectations:
  must_contain:
    - "operations"
  must_not_contain:
    - "error"
  function_calling:
    # Assess that LLM correctly generates operations for queue items
    check_operations: true
    # Should generate at least one relevant operation (flexible - LLM may choose different approaches)
    # We're testing function calling correctness, not specific operation types
    # Snapshot operation responses (deterministic - generated by our code, not LLM)
    snapshot_operations: "llm_ops_queue_focus_operations.json"

